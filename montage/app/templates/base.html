<!DOCTYPE html>
<html lang="zh-TW" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if title %}{{ title }} - {% endif %}蒙太奇之愛</title>
    
    <!-- Tailwind CSS CDN (開發用) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Typography Plugin -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        /* 自訂星級評分樣式 */
        .star-rating {
            display: inline-flex;
            font-size: 1.25rem;
            color: #fbbf24;
        }
        
        .star-empty {
            color: #d1d5db;
        }
    </style>
    
    {% block head %}{% endblock %}
</head>
<body class="h-full bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <!-- Logo and main nav -->
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <a href="{{ url_for('main.index') }}" class="text-2xl font-bold text-gray-900">
                            🎬 蒙太奇之愛
                        </a>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:space-x-8 whitespace-nowrap flex-shrink-0 items-center">
                        <a href="{{ url_for('main.index') }}" 
                           class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            首頁
                        </a>
                        <a href="{{ url_for('main.movies') }}" 
                           class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            電影
                        </a>
                        <a href="{{ url_for('main.ranking') }}" 
                           class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            排行榜
                        </a>
                    </div>
                </div>

                <!-- Search -->
                <div class="flex-1 flex items-center justify-center px-2 lg:ml-6 lg:justify-end">
                    <div class="max-w-lg w-full lg:max-w-xs">
                        <form action="{{ url_for('main.search') }}" method="GET" class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <input name="q" type="search" 
                                   class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-primary-500 focus:border-primary-500 sm:text-sm" 
                                   placeholder="搜尋電影..." 
                                   value="{{ request.args.get('q', '') }}">
                        </form>
                    </div>
                </div>

                <!-- User menu -->
                <div class="flex items-center">
                    {% if current_user.is_authenticated %}
                        <div class="ml-3 relative">
                            <div class="flex items-center space-x-4">
                                <a href="{{ url_for('main.user_profile', user_id=current_user.user_id) }}" 
                                   class="text-gray-500 hover:text-gray-700 text-sm font-medium">
                                    {{ current_user.display_name }}
                                </a>
                                <a href="/admin" 
                                   class="text-gray-500 hover:text-gray-700 text-sm font-medium">
                                    管理
                                </a>
                                <a href="{{ url_for('auth.logout') }}" 
                                   class="bg-primary-600 hover:bg-primary-700 text-white px-3 py-2 rounded-md text-sm font-medium">
                                    登出
                                </a>
                            </div>
                        </div>
                    {% else %}
                        <div class="flex items-center space-x-4">
                            <a href="{{ url_for('auth.login') }}" 
                               class="text-gray-500 hover:text-gray-700 text-sm font-medium">
                                登入
                            </a>
                            <a href="{{ url_for('auth.register') }}" 
                               class="bg-primary-600 hover:bg-primary-700 text-white px-3 py-2 rounded-md text-sm font-medium">
                                註冊
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4">
                {% for category, message in messages %}
                    <div class="mb-4 p-4 rounded-md {% if category == 'success' %}bg-green-50 text-green-800 border border-green-200{% elif category == 'danger' %}bg-red-50 text-red-800 border border-red-200{% elif category == 'warning' %}bg-yellow-50 text-yellow-800 border border-yellow-200{% else %}bg-blue-50 text-blue-800 border border-blue-200{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main content -->
    <main class="flex-1">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t mt-12">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <div class="text-center text-gray-500 text-sm">
                <p>&copy; 2024 蒙太奇之愛。電影評論社區。</p>
                <p class="mt-2">讓每部電影都有屬於它的故事</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // 星級評分功能
        function setRating(rating) {
            document.getElementById('rating').value = rating;
            updateStars(rating);
        }
        
        function updateStars(rating) {
            for (let i = 1; i <= 5; i++) {
                const star = document.getElementById(`star-${i}`);
                if (star) {
                    if (i <= rating) {
                        star.classList.remove('star-empty');
                        star.classList.add('text-yellow-400');
                    } else {
                        star.classList.add('star-empty');
                        star.classList.remove('text-yellow-400');
                    }
                }
            }
        }
        
        // Hero 輪播功能 (符合PRD要求：桌機自動5s、懸停暫停；手機手動)
        let currentSlide = 0;
        let slideInterval;
        const slides = document.querySelectorAll('.carousel-slide');
        const dots = document.querySelectorAll('.carousel-dot');
        const isMobile = window.innerWidth < 768;
        
        function showSlide(index) {
            // 隱藏所有幻燈片
            slides.forEach(slide => {
                slide.classList.remove('active');
                slide.classList.add('opacity-0');
            });
            
            // 重置所有點
            dots.forEach(dot => {
                dot.classList.remove('bg-opacity-100');
                dot.classList.add('bg-opacity-50');
            });
            
            // 顯示當前幻燈片
            if (slides[index]) {
                slides[index].classList.add('active');
                slides[index].classList.remove('opacity-0');
            }
            
            // 高亮當前點
            if (dots[index]) {
                dots[index].classList.remove('bg-opacity-50');
                dots[index].classList.add('bg-opacity-100');
            }
            
            currentSlide = index;
        }
        
        function nextSlide() {
            const nextIndex = (currentSlide + 1) % slides.length;
            showSlide(nextIndex);
        }
        
        function startAutoplay() {
            if (!isMobile && slides.length > 1) {
                slideInterval = setInterval(nextSlide, 5000); // 5秒自動播放
            }
        }
        
        function stopAutoplay() {
            if (slideInterval) {
                clearInterval(slideInterval);
            }
        }
        
        // 初始化輪播
        if (slides.length > 0) {
            showSlide(0);
            
            if (!isMobile) {
                // 桌機：自動播放，懸停暫停
                startAutoplay();
                
                const carousel = document.getElementById('carousel-container');
                if (carousel) {
                    carousel.addEventListener('mouseenter', stopAutoplay);
                    carousel.addEventListener('mouseleave', startAutoplay);
                }
            }
        }
        
        // 自動隱藏 flash 訊息
        setTimeout(function() {
            const alerts = document.querySelectorAll('[role="alert"]');
            alerts.forEach(alert => {
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 500);
            });
        }, 5000);
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
